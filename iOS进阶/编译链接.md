## Mach-O文件

mach-o是存储程序和库文件的文件格式，对应系统通过二进制接口ABI来运行该文件。保存了在编译和链接过程中产生的机器代码和数据，从而为静态链接和动态链接的代码提供了单一文件格式

mach-o = 文件配置 + 二进制代码

Mach-O 文件是可读可写的

![image-20221206152902873](http://xingyajie.oss-cn-hangzhou.aliyuncs.com/uPic/image-20221206152902873.png)

### 查看Mach-O文件信息命令

查看mach-header 

- objdump --macho -private-header ${MACH_PATH} //简单信息
- objdump --macho -private-headers ${MACH_PATH} //详细信息
- otool -h ${MACH_PATH} //简单信息
- otool -l ${MACH_PATH} //详细信息
- otool显示的是原始信息，不便阅读。objdump相对详细	

查看 __TEXT

- objdump --macho -d ${MACH_PATH}

查看符号表

- objdump --macho --syms ${MACH_PATH}

查看导出符号

- objdump --macho --exports-tire ${MACH_PATH}

查看间接符号表

- objdump --macho --indirect-symbols ${MACH_PATH}	

查看重定位符号表

- objdump --macho --reloc ${MACH_PATH}

## 编译

iOS编译过程：

- 载入源文件，.h / .m / .cpp等
- 预处理：替换宏，删除注释，展开头文件，产生.i文件
- 编译：将.i文件转换为汇编语言，产生.s文件
- 汇编：将汇编文件转换为机器码文件，产生.o文件
- 链接：对.o文件中引用其他库的地方进行引用，生成最后的可执行文件。本质就是把多个⽬标⽂件组合成⼀个⽂件

## dyld加载流程

dyld（the dynamic link editor）是苹果的动态链接器，是苹果操作系统的重要组成部分，在app被编译打包成可执行文件格式的Mach-O文件后，交由dyld负责链接，加载程序

dyld链接流程：

1. 加载libSystem
2. Runtime向dyld注册回调函数
3. 加载新的image
4. 执行map_images、load_images
5. Imageloader加载image。回到 3、4，直至加载完全
6. 调用main函数



















